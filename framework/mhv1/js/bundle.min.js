(()=>{var I=Object.defineProperty;var T=(r,e,t)=>e in r?I(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var $=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var B=(r,e,t)=>(T(r,typeof e!="symbol"?e+"":e,t),t);var V=$((F,m)=>{var b=class{constructor(e){this.config=e,this._core=new f(e),this.data=null}async loadData(){let e=await this._core.initialize();return await new Promise(t=>{this._core.isVideosLoaded()?t():this._core.on("videosLoaded",t)}),this.data={videos:this._core.getOrderedVideos(),categories:this._core.getCategories()},this.data}getVideo(e){return this._core.getVideo(e)}getOrderedVideos(){return this._core.getOrderedVideos()}filterByCategory(e){return this._core.filterByCategory(e)}searchVideos(e,t=null){return this._core.searchVideos(e,t)}on(e,t){return this._core.on(e,t)}};typeof window<"u"&&(window.MobileVideoCore=b);var f=class{constructor(e){this.config=e,this._videos=null,this._videoOrder=[],this._videoMap=new Map,this._categories=null,this._searchIndex={tokens:new Map,videoTokens:new Map},this._isInitialized=!1,this._isLoading=!1,this._loadPromise=null,this._errors=[],this._eventTarget=document.createElement("div")}async initialize(){return this._loadPromise?this._loadPromise:(this._loadPromise=(async()=>{this._isLoading=!0,this._dispatchEvent("loadStart");try{return await this._loadCategories(),this._dispatchEvent("categoriesLoaded",{categories:this._categories}),this._loadVideosAsync(),{categories:this._categories,isVideosLoading:!0}}catch(e){throw this._errors.push(e),this._dispatchEvent("loadError",{error:e,stage:"initialization"}),e}finally{this._isLoading=!1}})(),this._loadPromise)}getVideo(e){return this._videoMap.get(e)||null}getOrderedVideos(){return this._isInitialized?this._videoOrder.map(e=>this._videoMap.get(e)).filter(e=>e!==void 0):[]}getTotalVideoCount(){return this._videos?this._videos.length:0}getCategories(){return this._categories}isVideosLoaded(){return this._videos!==null}isSearchReady(){return this._searchIndex.tokens.size>0}filterByCategory(e){if(!e||!this._isInitialized)return this.getOrderedVideos();let t=e.split("|");return this.getOrderedVideos().filter(i=>{let s=i.category_data?.exact_paths||[];return t.length===1?s.some(o=>o===t[0]||o.startsWith(t[0]+"|")):t.length===2?s.some(o=>o===e||o.startsWith(e+"|")):t.length===3?s.includes(e):!1})}searchVideos(e,t=null){if(!e.trim())return t?this.filterByCategory(t):this.getOrderedVideos();if(!this.isSearchReady())return console.warn("Search index not ready, falling back to linear search"),this._linearSearch(e,t);let i=this._tokenize(e.toLowerCase()),s=null;i.forEach(a=>{let n=this._searchIndex.tokens.get(a);if(!n){s=new Set;return}if(s===null)s=new Set(n);else{let l=new Set;n.forEach(d=>{s.has(d)&&l.add(d)}),s=l}});let o=s?Array.from(s).map(a=>this.getVideo(a)).filter(a=>a!==null):[];return t&&(o=o.filter(a=>this._videoMatchesCategory(a,t))),o.sort((a,n)=>{let l=this._videoOrder.indexOf(a.id),d=this._videoOrder.indexOf(n.id);return l-d}),o}on(e,t){this._eventTarget.addEventListener(`videocore:${e}`,i=>{t(i.detail)})}async _loadCategories(){try{let e=this.config.dataVersion||"",t=`${this.config.dataBaseUrl}categories.json${e?`?v=${e}`:""}`,i=await fetch(t,{cache:"force-cache",headers:{Accept:"application/json"}});if(!i.ok){let s=await fetch(t);if(!s.ok)throw new Error(`Failed to load categories: ${s.status}`);this._categories=await s.json();return}this._categories=await i.json()}catch(e){throw console.error("Failed to load categories:",e),e}}async _loadVideosAsync(){try{this._dispatchEvent("videosLoadStart");let e=this.config.dataVersion||"",t=`${this.config.dataBaseUrl}videos.json${e?`?v=${e}`:""}`,i=await fetch(t,{cache:"force-cache",headers:{Accept:"application/json"},signal:AbortSignal.timeout?AbortSignal.timeout(1e4):null});if(!i.ok){let o=await fetch(t);if(!o.ok)throw new Error(`Failed to load videos: ${o.status}`);let a=await o.json();this._processVideoData(a);return}let s=await i.json();this._processVideoData(s)}catch(e){this._errors.push(e),this._dispatchEvent("loadError",{error:e,stage:"videos"})}}_processVideoData(e){this._videos=e.videos||[],this._videoOrder=e.video_order||[],this._videoMap.clear(),this._videos.forEach(t=>{this._videoMap.set(t.id,t)}),this._videoOrder.length===0&&(this._videoOrder=this._videos.map(t=>t.id)),this._buildSearchIndex(),this._isInitialized=!0,this._dispatchEvent("videosLoaded",{count:this._videos.length,videoOrder:this._videoOrder.length>0}),this._dispatchEvent("searchIndexReady",{tokenCount:this._searchIndex.tokens.size})}_buildSearchIndex(){console.time("buildSearchIndex"),this._searchIndex.tokens.clear(),this._searchIndex.videoTokens.clear(),this._videos.forEach(e=>{let t=this._getSearchableText(e),i=this._tokenize(t);this._searchIndex.videoTokens.set(e.id,new Set(i)),i.forEach(s=>{this._searchIndex.tokens.has(s)||this._searchIndex.tokens.set(s,new Set),this._searchIndex.tokens.get(s).add(e.id)})}),console.timeEnd("buildSearchIndex"),console.log(`Search index built: ${this._searchIndex.tokens.size} tokens for ${this._videos.length} videos`)}_getSearchableText(e){let t=[];return e.title&&t.push(e.title.toLowerCase()),e.search_tags&&Array.isArray(e.search_tags)&&e.search_tags.forEach(i=>{t.push(i.toLowerCase())}),e.category_data?.flat_categories&&e.category_data.flat_categories.forEach(i=>{t.push(i.toLowerCase())}),t.join(" ")}_tokenize(e){let t=new Set;return e.split(/[\s.,;!?()\[\]{}'"`\-–—]+/).filter(s=>s.length>0).forEach(s=>{t.add(s);let o=this._isTelugu(s)?2:3;if(s.length>=o)for(let a=o;a<=s.length;a++)t.add(s.substring(0,a))}),Array.from(t)}_isTelugu(e){return/[\u0C00-\u0C7F]/.test(e)}_videoMatchesCategory(e,t){let i=e.category_data?.exact_paths||[],s=t.split("|");return s.length===1?i.some(o=>o===s[0]||o.startsWith(s[0]+"|")):s.length===2?i.some(o=>o===t||o.startsWith(t+"|")):s.length===3?i.includes(t):!1}_linearSearch(e,t=null){let i=e.toLowerCase().trim();return(t?this.filterByCategory(t):this.getOrderedVideos()).filter(o=>{if(o.title.toLowerCase().includes(i))return!0;if(o.search_tags){for(let a of o.search_tags)if(a.toLowerCase().includes(i))return!0}if(o.category_data?.flat_categories){for(let a of o.category_data.flat_categories)if(a.toLowerCase().includes(i))return!0}return!1})}_dispatchEvent(e,t={}){let i=new CustomEvent(`videocore:${e}`,{detail:t});this._eventTarget.dispatchEvent(i),document.dispatchEvent(new CustomEvent(`videocore:${e}`,{detail:t}))}};typeof m<"u"&&m.exports?m.exports=f:typeof define=="function"&&define.amd?define([],function(){return f}):window.VideoCore=f;var P=class{constructor(e={}){this.config={autoplay:!1,autoplayNext:!0,playerVars:{rel:0,modestbranding:1,playsinline:1,enablejsapi:1,origin:window.location.origin},...e},this.players=new Map,this.currentPlayer=null,this.queue=[],this.APIReady=!1,this.APIReadyCallbacks=[]}async initialize(){return this.APIReady?!0:new Promise((e,t)=>{if(window.YT)window.YT.Player?(this.APIReady=!0,e(!0)):this.APIReadyCallbacks.push(e);else{let i=document.createElement("script");i.src="https://www.youtube.com/iframe_api";let s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(i,s),window.onYouTubeIframeAPIReady=()=>{this.APIReady=!0,this.APIReadyCallbacks.forEach(o=>o()),this.APIReadyCallbacks=[],e(!0)},setTimeout(()=>{this.APIReady||t(new Error("YouTube API failed to load"))},1e4)}})}createPlayer(e,t,i={}){if(!this.APIReady)throw new Error("YouTube API not ready");let s={videoId:t,width:"100%",height:"100%",playerVars:{...this.config.playerVars,...i.playerVars},events:{onReady:o=>{console.log(`Player ready for ${t}`),i.onReady&&i.onReady(o)},onStateChange:o=>{this._handleStateChange(o,t),i.onStateChange&&i.onStateChange(o)},onError:o=>{console.error(`YouTube player error for ${t}:`,o.data),i.onError&&i.onError(o)}}};try{let o=new YT.Player(e,s);return this.players.set(t,o),o}catch(o){throw console.error("Failed to create YouTube player:",o),o}}_handleStateChange(e,t){let s={[-1]:"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"cued"}[e.data]||"unknown";document.dispatchEvent(new CustomEvent("youtube:statechange",{detail:{videoId:t,state:s,player:e.target}})),s==="ended"&&this.config.autoplayNext&&this.queue.length>0&&this._playNextInQueue()}play(e){let t=this.players.get(e);return t&&t.playVideo?(this.currentPlayer&&this.currentPlayer!==t&&this.pause(this.currentPlayer),this.currentPlayer=t,t.playVideo(),!0):!1}pause(e){let t;return typeof e=="string"?t=this.players.get(e):t=e,t&&t.pauseVideo?(t.pauseVideo(),!0):!1}stop(e){let t=this.players.get(e);return t?(t.stopVideo&&t.stopVideo(),t.destroy&&t.destroy(),this.players.delete(e),this.currentPlayer===t&&(this.currentPlayer=null),!0):!1}stopAll(){this.players.forEach((e,t)=>{this.stop(t)}),this.currentPlayer=null,this.queue=[]}setQueue(e){this.queue=e}_playNextInQueue(){if(this.queue.length===0)return;let e=this.queue.shift();this.play(e.id),document.dispatchEvent(new CustomEvent("youtube:queuenext",{detail:{nextVideo:e,remaining:this.queue.length}}))}destroy(){this.stopAll(),this.players.clear(),this.queue=[],this.currentPlayer=null}},w=class{constructor(e={}){this.options={autoplay:!0,showControls:!0,closeOnEnd:!1,enablePlaylistNavigation:!0,...e},this.youtubePlayer=null,this.currentVideo=null,this.modal=null,this.playerContainer=null,this.playerInstance=null,this.currentPlaylist=null,this.playlistQueue=[],this.currentPlaylistIndex=-1,this.isPlaylistMode=!1,this._createModal(),this._setupEventListeners()}setYouTubePlayer(e){this.youtubePlayer=e}setPlaylist(e,t){this.currentPlaylist=e,this.playlistQueue=t||[],this.currentPlaylistIndex=-1,this.isPlaylistMode=t&&t.length>0,this._updatePlaylistInfo()}clearPlaylist(){this.currentPlaylist=null,this.playlistQueue=[],this.currentPlaylistIndex=-1,this.isPlaylistMode=!1,this._updatePlaylistInfo()}_createModal(){this.modal=document.getElementById("videoModal"),this.modal?this.playerContainer=document.getElementById("youtubePlayerContainer"):(document.body.insertAdjacentHTML("beforeend",`
                <div class="video-modal" id="videoModal">
                    <div class="modal-backdrop"></div>
                    <div class="modal-container">
                        <div class="modal-header">
                            <h3 class="video-title" id="videoModalTitle">Playing Video</h3>
                            <button class="modal-close" id="videoModalClose" aria-label="Close player">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="player-wrapper">
                                <div class="youtube-player-container" id="youtubePlayerContainer"></div>
                            </div>
                            <div class="video-controls">
                                <button class="control-btn prev-btn" aria-label="Previous video">
                                    <i class="fas fa-step-backward"></i>
                                </button>
                                <button class="control-btn play-btn" aria-label="Play/Pause">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="control-btn next-btn" aria-label="Next video">
                                    <i class="fas fa-step-forward"></i>
                                </button>
                                <button class="control-btn fullscreen-btn" aria-label="Fullscreen">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="playlist-info" id="playlistInfo"></div>
                        </div>
                    </div>
                </div>
            `),this.modal=document.getElementById("videoModal"),this.playerContainer=document.getElementById("youtubePlayerContainer"))}_setupEventListeners(){this.modal.querySelector(".modal-close").addEventListener("click",()=>this.hide()),this.modal.querySelector(".modal-backdrop").addEventListener("click",()=>this.hide()),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.modal.classList.contains("active")&&this.hide()}),this.modal.querySelector(".play-btn").addEventListener("click",()=>this._togglePlayPause()),this.modal.querySelector(".next-btn").addEventListener("click",()=>this._playNextInPlaylist()),this.modal.querySelector(".prev-btn").addEventListener("click",()=>this._playPreviousInPlaylist()),this.modal.querySelector(".fullscreen-btn").addEventListener("click",()=>this._toggleFullscreen()),document.addEventListener("youtube:statechange",n=>{n.detail.videoId===this.currentVideo?.id&&(this._updateControls(n.detail.state),n.detail.state==="ended"&&this.isPlaylistMode&&this.options.enablePlaylistNavigation&&this._handleVideoEnded())})}async play(e,t={}){if(this.currentVideo=e,this.isPlaylistMode){let o=this.playlistQueue.findIndex(a=>a.id===e.id);o!==-1&&(this.currentPlaylistIndex=o)}let i=this.modal.querySelector(".video-title");this.isPlaylistMode&&this.currentPlaylistIndex!==-1?i.textContent=`(${this.currentPlaylistIndex+1}/${this.playlistQueue.length}) ${e.title}`:i.textContent=e.title||"Playing Video",this.show(),this.playerInstance&&this.youtubePlayer.stop(this.currentVideo.id),this.playerContainer.innerHTML="";let s=document.createElement("div");s.id=`yt-player-${Date.now()}`,this.playerContainer.appendChild(s);try{return this.playerInstance=this.youtubePlayer.createPlayer(s.id,e.id,{playerVars:{autoplay:this.options.autoplay?1:0,controls:1,modestbranding:1,rel:0,playsinline:1},onReady:o=>{console.log("YouTube player ready in modal"),this._updateControls("ready"),this._updateNavigationButtons()},onStateChange:o=>{}}),this._updatePlaylistInfo(),this.playerInstance}catch(o){throw console.error("Failed to play video in modal:",o),this.hide(),o}}_playNextInPlaylist(){if(!this.isPlaylistMode||this.playlistQueue.length===0){console.log("Not in playlist mode or playlist empty");return}let e=this.currentPlaylistIndex+1;if(e>=this.playlistQueue.length){console.log("End of playlist reached");return}let t=this.playlistQueue[e];console.log("Playing next video:",t.title),this.play(t)}_playPreviousInPlaylist(){if(!this.isPlaylistMode||this.playlistQueue.length===0){console.log("Not in playlist mode or playlist empty");return}let e=this.currentPlaylistIndex-1;if(e<0){console.log("Already at first video");return}let t=this.playlistQueue[e];console.log("Playing previous video:",t.title),this.play(t)}_handleVideoEnded(){this.isPlaylistMode&&this.options.enablePlaylistNavigation&&setTimeout(()=>{this._playNextInPlaylist()},1500)}_updateNavigationButtons(){let e=this.modal.querySelector(".prev-btn"),t=this.modal.querySelector(".next-btn");if(!(!e||!t))if(this.isPlaylistMode){let i=this.currentPlaylistIndex>0,s=this.currentPlaylistIndex<this.playlistQueue.length-1;e.disabled=!i,e.style.opacity=i?"1":"0.5",e.style.cursor=i?"pointer":"not-allowed",t.disabled=!s,t.style.opacity=s?"1":"0.5",t.style.cursor=s?"pointer":"not-allowed"}else e.disabled=!0,e.style.opacity="0.5",e.style.cursor="not-allowed",t.disabled=!0,t.style.opacity="0.5",t.style.cursor="not-allowed"}_updatePlaylistInfo(){let e=document.getElementById("playlistInfo");if(e){if(this.isPlaylistMode&&this.playlistQueue.length>0){let t=this.currentPlaylistIndex+1,i=this.playlistQueue.length;e.innerHTML=`
                <div class="current-playlist-info">
                    <i class="fas fa-list"></i>
                    <span>Playlist: ${t}/${i}</span>
                </div>
            `,e.style.display="block"}else e.innerHTML="",e.style.display="none";this._updateNavigationButtons()}}show(){this.modal.classList.add("active"),document.body.style.overflow="hidden"}hide(){this.modal.classList.remove("active"),document.body.style.overflow="",this.currentVideo&&this.youtubePlayer&&this.youtubePlayer.stop(this.currentVideo.id),this.currentVideo=null,this.playerInstance=null}_togglePlayPause(){if(!this.currentVideo||!this.playerInstance)return;let e=this.youtubePlayer.players.get(this.currentVideo.id);e&&(e.getPlayerState()===YT.PlayerState.PLAYING?e.pauseVideo():e.playVideo())}_toggleFullscreen(){this.modal.classList.toggle("fullscreen");let e=this.modal.querySelector(".fullscreen-btn i");this.modal.classList.contains("fullscreen")?e.className="fas fa-compress":e.className="fas fa-expand"}_updateControls(e){let i=this.modal.querySelector(".play-btn").querySelector("i");switch(e){case"playing":i.className="fas fa-pause";break;case"paused":case"ended":i.className="fas fa-play";break;case"buffering":i.className="fas fa-spinner fa-spin";break;default:i.className="fas fa-play"}}destroy(){this.hide(),this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal)}},_=class{constructor(){this.storageKey="videoLibrary_playlists",this.defaultPlaylists={favorites:{name:"Favorites",videos:[],created:new Date().toISOString()},watch_later:{name:"Watch Later",videos:[],created:new Date().toISOString()}},this.playlists=this._loadFromStorage(),this._ensureDefaultPlaylists()}_loadFromStorage(){try{let e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch(e){return console.error("Failed to load playlists:",e),{}}}_saveToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.playlists))}catch(e){console.error("Failed to save playlists:",e)}}_ensureDefaultPlaylists(){let e=!1;Object.keys(this.defaultPlaylists).forEach(t=>{this.playlists[t]||(this.playlists[t]={...this.defaultPlaylists[t]},e=!0)}),e&&this._saveToStorage()}addVideo(e,t="watch_later",i,s){if(!this.playlists[t])return console.error(`Playlist ${t} not found`),!1;let o=this.playlists[t];return o.videos.some(n=>n.id===e.id)?(console.log(`Video already in ${o.name}`),!1):(o.videos.push({id:e.id,title:e.title,thumbnail:s,youtube_url:i,addedAt:new Date().toISOString()}),this._saveToStorage(),console.log(`Added to ${o.name}: ${e.title}`),!0)}removeVideo(e,t){let i=this.playlists[t];if(!i)return!1;let s=i.videos.length;return i.videos=i.videos.filter(o=>o.id!==e),i.videos.length<s?(this._saveToStorage(),console.log(`Removed video from ${i.name}`),!0):!1}getPlaylist(e){return this.playlists[e]}getAllPlaylists(){return this.playlists}isInPlaylist(e,t){let i=this.playlists[t];return i?i.videos.some(s=>s.id===e):!1}getPlaylistCount(e){let t=this.playlists[e];return t?t.videos.length:0}getPlaylistVideos(e){let t=this.playlists[e];return t?t.videos:[]}clearPlaylist(e){let t=this.playlists[e];if(!t)return!1;let i=t.videos.length>0;return t.videos=[],i?(this._saveToStorage(),console.log(`Cleared playlist: ${t.name}`),!0):!1}getPlaylistName(e){let t=this.playlists[e];return t?t.name:e}getPlaylistQueue(e){let t=this.playlists[e];return t?[...t.videos]:[]}getNextVideo(e,t=null){let i=this.playlists[e];if(!i||i.videos.length===0)return null;if(!t)return i.videos[0];let s=i.videos.findIndex(o=>o.id===t);return s===-1||s>=i.videos.length-1?null:i.videos[s+1]}getPreviousVideo(e,t=null){let i=this.playlists[e];if(!i||i.videos.length===0)return null;if(!t)return i.videos[0];let s=i.videos.findIndex(o=>o.id===t);return s<=0?null:i.videos[s-1]}hasNextVideo(e,t){let i=this.playlists[e];if(!i)return!1;let s=i.videos.findIndex(o=>o.id===t);return s!==-1&&s<i.videos.length-1}hasPreviousVideo(e,t){let i=this.playlists[e];return i?i.videos.findIndex(o=>o.id===t)>0:!1}toggleFavorite(e,t,i){let s="favorites",o=this.playlists[s];if(!o)return console.error("Favorites playlist not found"),{added:!1,action:"error"};let a=o.videos.findIndex(n=>n.id===e.id);return a!==-1?(o.videos.splice(a,1),this._saveToStorage(),console.log(`Removed from favorites: ${e.title}`),{added:!1,action:"removed",playlistId:s}):(o.videos.push({id:e.id,title:e.title,thumbnail:i,youtube_url:t,addedAt:new Date().toISOString()}),this._saveToStorage(),console.log(`Added to favorites: ${e.title}`),{added:!0,action:"added",playlistId:s})}isFavorite(e){let t=this.playlists.favorites;return t?t.videos.some(i=>i.id===e):!1}getFavorites(){return this.getPlaylistVideos("favorites")}getFavoritesCount(){return this.getPlaylistCount("favorites")}clearFavorites(){return this.clearPlaylist("favorites")}},C=class{constructor(e,t,i={}){this.container=document.getElementById(e),this.core=t,this.options={autoCollapseMobile:!0,allowMultipleExpandedDesktop:!1,showCounts:!0,...i},this.state={activePath:null,expandedPaths:new Set,isMobile:window.innerWidth<768,isTablet:window.innerWidth>=768&&window.innerWidth<1024},this._boundHandleClick=null,this._initialize()}_initialize(){if(!this.container){console.error("CategoryTree: Container not found");return}this._updateResponsiveState(),window.addEventListener("resize",()=>{this._updateResponsiveState()})}_updateResponsiveState(){let e=this.state.isMobile,t=this.state.isTablet;this.state.isMobile=window.innerWidth<768,this.state.isTablet=window.innerWidth>=768&&window.innerWidth<1024,(e!==this.state.isMobile||t!==this.state.isTablet)&&this.render()}async render(){let e=this.core.getCategories();if(!e?.hierarchy){console.error("CategoryTree: No categories available");return}this.container.innerHTML=this._buildTreeHTML(e.hierarchy),this._attachEventListeners(),this._applyInitialViewState()}_buildTreeHTML(e){let t='<div class="category-tree">';for(let[i,s]of Object.entries(e)){let o=s.subcategories&&Object.keys(s.subcategories).length>0;t+=`
                <div class="category-group">
                    <div class="category-item level-0" data-path="${i}">
                        <div class="category-content">
                            ${s.icon?`
                                <div class="category-icon">
                                    <i class="${s.icon}"></i>
                                </div>
                            `:'<div class="category-icon"></div>'}
                            <div class="category-text">${s.name||i}</div>
                            ${this.options.showCounts?`
                                <div class="category-count">${s.count||0}</div>
                            `:""}
                        </div>
                        ${o?`
                            <div class="chevron-container">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        `:'<div class="chevron-container no-children"></div>'}
                    </div>
                    ${o?this._buildChildrenHTML(i,s.subcategories,1):""}
                </div>
            `}return t+="</div>",t}_buildChildrenHTML(e,t,i){let s=`<div class="category-children" data-parent="${e}">`;for(let[o,a]of Object.entries(t)){let n=i===1?`${e}|${o}`:o,l=a.subsubcategories&&Object.keys(a.subsubcategories).length>0;s+=`
                <div class="category-item level-${i}" data-path="${n}">
                    <div class="category-content">
                        ${i===1?`
                            <div class="category-icon">
                                <i class="fas fa-circle"></i>
                            </div>
                        `:'<div class="category-icon"></div>'}
                        <div class="category-text">${a.name||o}</div>
                        ${this.options.showCounts?`
                            <div class="category-count">${a.count||0}</div>
                        `:""}
                    </div>
                    ${l?`
                        <div class="chevron-container">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    `:'<div class="chevron-container no-children"></div>'}
                </div>
                ${l?this._buildGrandChildrenHTML(n,a.subsubcategories):""}
            `}return s+="</div>",s}_buildGrandChildrenHTML(e,t){let i=`<div class="category-children" data-parent="${e}">`;for(let[s,o]of Object.entries(t)){let a=`${e}|${s}`;i+=`
                <div class="category-item level-2" data-path="${a}">
                    <div class="category-content">
                        <div class="category-icon"></div>
                        <div class="category-text">${o.name||s}</div>
                        ${this.options.showCounts?`
                            <div class="category-count">${o.count||0}</div>
                        `:""}
                    </div>
                    <div class="chevron-container no-children"></div>
                </div>
            `}return i+="</div>",i}_attachEventListeners(){this._boundHandleClick&&this.container.removeEventListener("click",this._boundHandleClick),this._boundHandleClick=this._handleClick.bind(this),this.container.addEventListener("click",this._boundHandleClick)}_handleClick(e){let t=e.target,i=t.closest(".chevron-container");if(i&&!i.classList.contains("no-children")){e.stopPropagation(),e.preventDefault();let o=i.closest(".category-item");if(o){let a=o.dataset.path;this._toggleCategory(a)}return}let s=t.closest(".category-item");if(s){e.stopPropagation();let o=s.dataset.path;this.selectCategory(o,{autoExpand:!0,collapseOthers:!0}),this.state.isMobile&&this._closeMobileSidebar()}}_getHierarchyPaths(e){let t=[],i=e.split("|");return i.length>=1&&t.push(i[0]),i.length>=2&&t.push(`${i[0]}|${i[1]}`),i.length>=3&&t.push(e),t}_toggleCategory(e){this.state.expandedPaths.has(e)?this.collapseCategory(e):this.expandCategory(e)}expandCategory(e){this.state.expandedPaths.add(e),this._updateCategoryUI(e,!0)}collapseCategory(e){this.state.expandedPaths.delete(e),this._updateCategoryUI(e,!1)}_updateCategoryUI(e,t){let i=this.container.querySelector(`[data-path="${e}"]`);if(!i)return;i.classList.toggle("expanded",t);let s=i.querySelector(".chevron-container i");s&&(s.style.transform=t?"rotate(180deg)":"rotate(0deg)");let o=this._getChildrenContainer(i);o&&o.classList.contains("category-children")&&(t?o.classList.add("expanded"):o.classList.remove("expanded"))}_getChildrenContainer(e){if(e.classList.contains("level-0")){let t=e.closest(".category-group");if(t)return t.querySelector(".category-children")}else return e.nextElementSibling;return null}selectCategory(e,t={}){let{autoExpand:i=!0,collapseOthers:s=!0}=t,o=this._getHierarchyPaths(e);this.container.querySelectorAll(".category-item").forEach(a=>{a.classList.remove("active")}),o.forEach(a=>{let n=this.container.querySelector(`[data-path="${a}"]`);n&&n.classList.add("active")}),this.state.activePath=e,i&&this._expandToCategory(e),s&&this.collapseAllExcept(e),this._dispatchSelectionEvent(e)}_expandToCategory(e){let t=e.split("|");if(t.length>=1&&this.expandCategory(t[0]),t.length>=2){let i=`${t[0]}|${t[1]}`;this.expandCategory(i)}}collapseAllExcept(e){let t=new Set,i=e.split("|");i.length>=1&&t.add(i[0]),i.length>=2&&t.add(`${i[0]}|${i[1]}`),new Set(this.state.expandedPaths).forEach(o=>{t.has(o)||this.collapseCategory(o)})}clearSelection(){this.state.activePath=null,this.container.querySelectorAll(".category-item").forEach(e=>{e.classList.remove("active")}),this._dispatchSelectionEvent(null)}_applyInitialViewState(){this.state.isMobile?(this.state.expandedPaths.clear(),this.container.querySelectorAll(".category-children").forEach(e=>{e.classList.remove("expanded")}),this.container.querySelectorAll(".category-item").forEach(e=>{e.classList.remove("expanded");let t=e.querySelector(".chevron-container i");t&&(t.style.transform="rotate(0deg)")})):(this.state.expandedPaths.clear(),this.container.querySelectorAll(".category-children").forEach(e=>{e.classList.remove("expanded")}),this.container.querySelectorAll(".category-item").forEach(e=>{e.classList.remove("expanded");let t=e.querySelector(".chevron-container i");t&&(t.style.transform="rotate(0deg)")}),this.state.activePath&&this._expandToCategory(this.state.activePath))}_closeMobileSidebar(){let e=document.getElementById("sidebar"),t=document.getElementById("sidebarOverlay");e&&e.classList.remove("active"),t&&t.classList.remove("active"),document.body.classList.remove("sidebar-open")}_dispatchSelectionEvent(e){let t=new CustomEvent("categorytree:selected",{detail:{categoryPath:e,timestamp:Date.now()}});this.container.dispatchEvent(t)}updateViewport(e){window.innerWidth=e,this._updateResponsiveState()}getActiveCategory(){return this.state.activePath}isExpanded(e){return this.state.expandedPaths.has(e)}},E=class{constructor(e,t){this.container=document.getElementById(e),this.core=t,this.currentVideos=[],this.currentPage=1,this.pageSize=this._calculatePageSize(),this.isLoading=!1,this.hasMoreVideos=!0,this.renderedCards=new Map,this.scrollHandler=this._throttle(this._handleScroll.bind(this),200),this._handleScrollBound=null,this.scrollContainer=null,this.playerManager=null,this.videoPlayer=null,this.hasLCPPrioritized=!1,this.initialLoadCompleted=!1}async render(e=null){this.container&&(console.log(`VideoGrid.render() called with ${e?.length||"all"} videos`),e!==null&&(this.hasLCPPrioritized=!1,this.currentVideos=e,this.currentPage=1,this.hasMoreVideos=e.length>this.pageSize,this.renderedCards.clear(),this.container.innerHTML=""),this.currentVideos.length===0&&(this.currentVideos=this.core.getOrderedVideos(),this.hasMoreVideos=this.currentVideos.length>this.pageSize),this._renderCurrentPage(),this._setupLazyLoading(),this.hasMoreVideos&&this._setupScrollPagination(),this.currentPage===1&&e===null&&this._initLCPOptimization())}_renderCurrentPage(){let e=(this.currentPage-1)*this.pageSize,t=Math.min(e+this.pageSize,this.currentVideos.length),i=this.currentVideos.slice(e,t);console.log(`Rendering page ${this.currentPage}: videos ${e}-${t}`);let s=0;i.forEach(o=>{if(!this.renderedCards.has(o.id)){let a=this._createVideoCard(o);this.container.appendChild(a),this.renderedCards.set(o.id,a),s++}}),this.hasMoreVideos=t<this.currentVideos.length,console.log(`Page ${this.currentPage} rendered. Added ${s} cards. Has more: ${this.hasMoreVideos}`)}_createVideoCard(e){let t=document.createElement("div");t.className="video-card",t.dataset.videoId=e.id;let i=e.category_data?.flat_categories?.[0]||"uncategorized",s=`category-${i.replace(/\s+/g,"-").toLowerCase()}`,o=e.isFavorite||!1,a=`https://www.youtube.com/watch?v=${e.id}`,n=this._getThumbnailUrl(e.id,e.thmb),l=this.renderedCards.size===0&&this.currentPage===1,d=l?"high":"auto",c=l?"eager":"lazy";t.innerHTML=`
            <div class="video-thumbnail">
                <img 
                    src="${n}" 
                    alt="${e.title}"
                    loading="${c}"
                    decoding="async"
                    fetchpriority="${d}"
                    onload="this.style.opacity='1'"
                    style="opacity:0; transition: opacity 0.3s"
                >
                <div class="play-overlay">
                    <i class="fas fa-play"></i>
                </div>
                <div class="player-container"></div>
            </div>
            <div class="video-info">
                <h3 class="video-title" title="${e.title}">${e.title}</h3>
                <div class="video-meta">
                    <span class="video-category ${s}">
                        ${i}
                    </span>
                    <div class="video-meta-buttons">
                        <button class="watch-button" data-video-id="${e.id}">
                            <i class="fas fa-play-circle"></i> 
                        </button>
                        <button class="add-to-playlist-button" data-video-id="${e.id}" title="Add to playlist">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="favorite-button ${o?"favorited":""}" 
                                data-video-id="${e.id}" 
                                title="${o?"Remove from Favorites":"Add to Favorites"}">
                            <i class="${o?"fas":"far"} fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
        `,l&&console.log('LCP candidate created with fetchpriority="high":',e.id);let y=t.querySelector(".video-thumbnail"),g=t.querySelector(".play-overlay"),h=t.querySelector(".watch-button"),p=t.querySelector(".add-to-playlist-button");return y.addEventListener("click",u=>{u.target.closest(".watch-button")||u.target.closest(".add-to-playlist-button")||u.target.closest(".player-container")||this._playVideoInCard(e,t)}),h.addEventListener("click",u=>{u.stopPropagation();let v={...e,youtube_url:a};this._playVideoInOverlay(v)}),p.addEventListener("click",u=>{u.stopPropagation(),this._addToPlaylist(e)}),t.querySelector(".favorite-button").addEventListener("click",u=>{u.stopPropagation(),this._toggleFavorite(e)}),t}_getThumbnailUrl(e,t){let i=[{domain:"i.ytimg.com",ext:"jpg",size:"hqdefault"},{domain:"img.youtube.com",ext:"jpg",size:"hqdefault"},{domain:"i.ytimg.com",ext:"webp",size:"hqdefault"},{domain:"i.ytimg.com",ext:"webp",size:"sddefault"},{domain:"i.ytimg.com",ext:"webp",size:"mqdefault"},{domain:"i.ytimg.com",ext:"jpg",size:"sddefault"},{domain:"i.ytimg.com",ext:"jpg",size:"mqdefault"}],s=i[t]||i[0];if(s.domain==="i.ytimg.com"&&s.ext==="webp")return`https://i.ytimg.com/vi_webp/${e}/${s.size}.webp`;{let o=(s.domain==="i.ytimg.com","vi");return`https://${s.domain}/${o}/${e}/${s.size}.jpg`}}_setupScrollPagination(){console.log("Setting up scroll pagination"),this.scrollContainer=document.querySelector(".app-content")||window,this._handleScrollBound&&(this.scrollContainer.removeEventListener("scroll",this._handleScrollBound),window.removeEventListener("resize",this._handleScrollBound)),this._handleScrollBound||(this._handleScrollBound=this._handleScroll.bind(this)),this.scrollContainer.addEventListener("scroll",this._handleScrollBound),window.addEventListener("resize",this._handleScrollBound),setTimeout(()=>this._handleScrollBound(),100)}_setupLazyLoading(){this.container.querySelectorAll("img").forEach(e=>{e.complete||(e.style.opacity="0",e.onload=()=>{e.style.opacity="1"},e.onerror=()=>{console.warn("Failed to load thumbnail:",e.src),e.style.opacity="1"})})}_handleScroll(){if(this.isLoading||!this.hasMoreVideos)return;let e,t,i;this.scrollContainer===window?(e=window.scrollY||document.documentElement.scrollTop,t=document.documentElement.scrollHeight,i=window.innerHeight):(e=this.scrollContainer.scrollTop,t=this.scrollContainer.scrollHeight,i=this.scrollContainer.clientHeight),(e+i)/t>.8&&(console.log("Scrolled to 80%, loading next page..."),this._loadNextPage())}async _loadNextPage(){if(this.isLoading||!this.hasMoreVideos){console.log("Cannot load next page");return}console.log(`Loading page ${this.currentPage+1}`),this.isLoading=!0;let e=document.createElement("div");e.className="video-grid-loader",e.innerHTML='<div class="spinner"></div>',e.style.textAlign="center",e.style.padding="20px",this.container.appendChild(e),await new Promise(t=>setTimeout(t,200)),this.currentPage++,this._renderCurrentPage(),e.remove(),this.isLoading=!1,console.log(`Page ${this.currentPage} loaded successfully`)}_playVideo(e){let t=new CustomEvent("videogrid:play",{detail:{videoId:e}});this.container.dispatchEvent(t),console.log(`Play video: ${e}`)}_openYouTube(e){window.open(e,"_blank")}_calculatePageSize(){let e=window.innerWidth;return e<640?6:e<1024?12:24}_throttle(e,t){let i;return function(){let s=arguments,o=this;i||(e.apply(o,s),i=!0,setTimeout(()=>i=!1,t))}}updateViewport(){let e=this._calculatePageSize();e!==this.pageSize&&(this.pageSize=e,this.render(this.currentVideos))}destroy(){this.scrollContainer&&this._handleScrollBound&&this.scrollContainer.removeEventListener("scroll",this._handleScrollBound),window.removeEventListener("resize",this._handleScrollBound)}_playVideoInCard(e,t){console.log("Playing video in card:",e.id);let i=new CustomEvent("videogrid:playincard",{detail:{video:e,card:t}});this.container.dispatchEvent(i)}setPlayerManager(e){this.playerManager=e}setVideoPlayer(e){this.videoPlayer=e}_playVideoInOverlay(e){console.log("Playing video in overlay:",e.id);let t=new CustomEvent("videogrid:playinoverlay",{detail:{video:e}});this.container.dispatchEvent(t)}_addToPlaylist(e){console.log("Adding to playlist:",e.id);let t=new CustomEvent("videogrid:addtoplaylist",{detail:{video:e}});this.container.dispatchEvent(t)}_toggleFavorite(e){let t=new CustomEvent("videogrid:togglefavorite",{detail:{video:e}});this.container.dispatchEvent(t)}_initLCPOptimization(){this.hasLCPPrioritized||(this.hasLCPPrioritized=!0,console.log("LCP optimization initialized"))}_forceLCPPriority(){let e=this.container.querySelector(".video-thumbnail img");if(e&&!e.complete){e.setAttribute("fetchpriority","high"),e.loading="eager";let t=e.src;t&&(e.src="",e.src=t),console.log("Forced LCP priority on:",e.src)}}_optimizeVisibleThumbnails(){if(this.hasLCPPrioritized)return;let e=this._getVisibleThumbnails();e.sort((i,s)=>{let o=i.getBoundingClientRect(),a=s.getBoundingClientRect();return Math.abs(o.top-a.top)<10?o.left-a.left:o.top-a.top}),e.slice(0,3).forEach(i=>{i.getAttribute("fetchpriority")!=="high"&&(i.setAttribute("fetchpriority","high"),console.log("LCP prioritized:",i.src))}),this.hasLCPPrioritized=!0}_getVisibleThumbnails(){let e=this.container.querySelectorAll(".video-thumbnail img"),t=[],i=window.innerHeight,s=window.innerWidth;return e.forEach(o=>{if(o.complete||o.getAttribute("fetchpriority")==="high")return;let a=o.getBoundingClientRect();a.top>=-100&&a.left>=-100&&a.bottom<=i+100&&a.right<=s+100&&t.push(o)}),t}},x=class{constructor(e){B(this,1);this.config={...e,dataBaseUrl:e.dataBaseUrl||"./data/"},this.core=new b(this.config),this.categoryTree=null,this.videoGrid=null,this.currentFilters={category:null,search:""},this.youtubePlayer=null,this.videoPlayer=null,this.playlistManager=null,this.playlistManager=null,this.currentPlaylist="watch_later",this.playlistView=null,this.currentPlaylistId=null,this.currentPlaylistQueue=[],this.currentPlaylistIndex=-1,this.isPlaylistPlaying=!1,this.favorites=new Set,this.init()}async init(){try{this._showLoading(!0),await this.core.loadData();let e=this.core.getOrderedVideos();this._initCategoryTree(),this._initVideoGrid(e),this._initEventListeners(),this._showLoading(!1),this._updateCounts(e.length,e.length),await this._initYouTubePlayer(),this._initVideoPlayer(),this._initPlaylistManager(),this._initPlaylistSystem(),this._setupPlayerEvents(),this.playlistManager&&this._loadFavorites()}catch(e){console.error("\u274C Initialization failed:",e),this._showError("Failed to load videos. Please refresh.")}}_initVideoGrid(e){if(!document.getElementById("videoGrid")){console.warn("Video grid container not found");return}this.videoGrid=new E("videoGrid",this.core._core),this.videoGrid.render(e)}_initCategoryTree(){let e=document.getElementById("categoryList");if(!e){console.warn("Category container not found");return}this.categoryTree=new C("categoryList",this.core._core),this.categoryTree.render(),e.addEventListener("categorytree:selected",t=>{this.currentFilters.category=t.detail.categoryPath,this._applyFilters()}),console.log("\u2705 CategoryTree initialized")}_initEventListeners(){console.log("Initializing event listeners...");let e=document.getElementById("searchBox"),t=document.getElementById("clearSearch");this.searchBox=null;let i=null;if(e){console.log("\u{1F527} Setting up search box");let l=e.parentNode,d=e.cloneNode(!0);l.replaceChild(d,e),i=document.getElementById("searchBox"),this.searchBox=i;let c=this,y;i.addEventListener("input",function(g){console.log("\u2328\uFE0F Search input:",g.target.value),clearTimeout(y),y=setTimeout(()=>{let h=g.target.value.trim();console.log("\u{1F50D} Executing search for:",h),c.currentFilters.search=h,c._applyFilters()},300)}),console.log("\u2705 Search event listener attached"),this._initPlaylistViewToggle()}if(t){console.log("\u{1F527} Setting up clear search");let l=t.parentNode,d=t.cloneNode(!0);l.replaceChild(d,t),document.getElementById("clearSearch").addEventListener("click",()=>{console.log("\u{1F9F9} Clear search clicked"),this.searchBox&&(this.searchBox.value="",this.searchBox.focus()),this.currentFilters.search="",this._applyFilters()})}let s=document.getElementById("clearFilters");if(s){console.log("\u{1F527} Setting up clear filters button");let l=s.parentNode,d=s.cloneNode(!0);l.replaceChild(d,s),document.getElementById("clearFilters").addEventListener("click",()=>{console.log("\u{1F9F9} Clear filters clicked"),this._clearFilters()})}let o=document.getElementById("menuToggle"),a=document.getElementById("closeSidebar"),n=document.getElementById("sidebarOverlay");o&&o.addEventListener("click",()=>this._toggleSidebar()),a&&a.addEventListener("click",()=>this._toggleSidebar(!1)),n&&n.addEventListener("click",()=>this._toggleSidebar(!1)),console.log("\u2705 Event listeners initialized")}_initPlaylistSystem(){this._initPlaylistViewToggle(),document.getElementById("playlistView")?(this._initPlaylistTabs(),this._initPlaylistActions(),this._updatePlaylistCounts()):console.warn("Playlist view HTML not found")}_initPlaylistManager(){this.playlistManager=new _,console.log("\u2705 Playlist Manager initialized")}_applyFilters(){console.log("=== _applyFilters() called ==="),console.log("Filters:",this.currentFilters);let e;this.currentFilters.search?(console.log(`Searching: "${this.currentFilters.search}"`),e=this.core.searchVideos(this.currentFilters.search,this.currentFilters.category),console.log(`Search results: ${e?.length||0} videos`)):this.currentFilters.category?(console.log(`Filtering by category: "${this.currentFilters.category}"`),e=this.core.filterByCategory(this.currentFilters.category),console.log(`Category results: ${e?.length||0} videos`)):(console.log("Showing all videos"),e=this.core.getOrderedVideos(),console.log(`All videos: ${e?.length||0} videos`)),(!e||!Array.isArray(e))&&(console.error("No videos returned or not an array:",e),e=[]),console.log(`Passing ${e.length} videos to VideoGrid`),this.videoGrid?this.videoGrid.render(e):console.error("videoGrid not initialized!"),this._updateCounts(e.length,this.core.getOrderedVideos().length),this._updateFilterStatus(),this._toggleEmptyState(e.length===0),window.innerWidth<768&&this.currentFilters.category&&(console.log("\u{1F4F1} Mobile: Closing sidebar after category selection"),this._toggleSidebar(!1));let t=this.currentFilters.search||this.currentFilters.category;this._toggleClearFiltersButton(t),this._updateBulkFavoriteButton(e.length,t),console.log("=== _applyFilters() complete ===")}_clearFilters(){console.log("Clearing all filters"),this.currentFilters={category:null,search:""};let e=document.getElementById("searchBox");if(e&&(e.value=""),this.categoryTree&&this.categoryTree.clearSelection(),this.videoGrid){let i=this.core.getOrderedVideos();this.videoGrid.render(i)}let t=this.core.getOrderedVideos().length;this._updateCounts(t,t),this._toggleEmptyState(!1),this._toggleClearFiltersButton(!1),this._hideBulkFavoriteButton()}_updateCounts(e,t){let i=document.getElementById("visibleCount"),s=document.getElementById("totalCount");i&&(i.textContent=e,i.classList.add("count-updated"),setTimeout(()=>i.classList.remove("count-updated"),300)),s&&(s.textContent=t)}_updateFilterStatus(){let e=document.getElementById("filterStatus");if(!e)return;let{search:t,category:i}=this.currentFilters;t&&i?e.textContent=`"${t}" in ${i}`:t?e.textContent=`"${t}"`:i?e.textContent=i:e.textContent="All videos"}_toggleEmptyState(e){let t=document.getElementById("emptyState"),i=document.getElementById("videoGrid");t&&(t.style.display=e?"block":"none"),i&&(i.style.display=e?"none":"grid")}_showLoading(e){let t=document.getElementById("loadingIndicator");t&&(t.style.display=e?"flex":"none")}_showError(e){let t=document.getElementById("loadingIndicator");t&&(t.innerHTML=`
                <div class="error-icon">\u26A0\uFE0F</div>
                <p>${e}</p>
                <button onclick="location.reload()">Retry</button>
            `)}_toggleSidebar(e){let t=document.getElementById("sidebar"),i=document.getElementById("sidebarOverlay");if(!t)return;if(window.innerWidth<768)e!==void 0?e===!0?(t.classList.add("active"),i&&i.classList.add("active"),document.body.classList.add("sidebar-open")):e===!1&&(t.classList.remove("active"),i&&i.classList.remove("active"),document.body.classList.remove("sidebar-open")):t.classList.contains("active")?(t.classList.remove("active"),i&&i.classList.remove("active"),document.body.classList.remove("sidebar-open")):(t.classList.add("active"),i&&i.classList.add("active"),document.body.classList.add("sidebar-open"));else{let o=t.classList.contains("collapsed");e!==void 0?e===!0?t.classList.remove("collapsed"):e===!1&&t.classList.add("collapsed"):o?t.classList.remove("collapsed"):t.classList.add("collapsed");let a=document.getElementById("menuToggle");a&&(a.innerHTML='<i class="fas fa-bars"></i>')}}_toggleClearFiltersButton(e){let t=document.getElementById("clearFilters");t&&(e?t.classList.add("visible"):t.classList.remove("visible"))}async _initYouTubePlayer(){this.youtubePlayer=new P({autoplay:!1,autoplayNext:!0,playerVars:{rel:0,modestbranding:1,playsinline:1}}),await this.youtubePlayer.initialize(),console.log("YouTube Player initialized")}_initVideoPlayer(){this.videoPlayer=new w({mode:"overlay",autoplay:!0,showControls:!0}),this.videoPlayer.setYouTubePlayer(this.youtubePlayer),console.log("Video Player initialized")}_initPlaylistManager(){this.playlistManager=new _,console.log("Playlist Manager initialized")}_setupPlayerEvents(){this.videoGrid&&this.videoGrid.container&&(this.videoGrid.container.addEventListener("videogrid:playincard",e=>{this._handleInCardPlayback(e.detail.video,e.detail.card)}),this.videoGrid.container.addEventListener("videogrid:playinoverlay",e=>{this._handleOverlayPlayback(e.detail.video)}),this.videoGrid.container.addEventListener("videogrid:addtoplaylist",e=>{this._handleAddToPlaylist(e.detail.video)})),this.videoGrid&&(this.videoGrid.setPlayerManager(this.youtubePlayer),this.videoGrid.setVideoPlayer(this.videoPlayer)),this.videoGrid&&this.videoGrid.container&&this.videoGrid.container.addEventListener("videogrid:togglefavorite",e=>{this._handleToggleFavorite(e.detail.video)})}_handleInCardPlayback(e,t){console.log("Playing video in-card:",e.id),document.querySelectorAll(".video-card.playing").forEach(a=>{a!==t&&this._cleanupCardPlayer(a)});let i=t.querySelector(".player-container"),s=t.querySelector(".video-thumbnail");if(!i){console.error("Player container not found in card");return}if(i.classList.contains("active")){this._cleanupCardPlayer(t);return}document.querySelectorAll(".player-container.active").forEach(a=>{let n=a.closest(".video-card");n&&n!==t&&this._cleanupCardPlayer(n)}),i.innerHTML="";let o=document.createElement("div");o.id=`mini-player-${Date.now()}-${e.id}`,i.appendChild(o),i.classList.add("active"),s.classList.add("has-player"),t.classList.add("playing");try{this.youtubePlayer.createPlayer(o.id,e.id,{playerVars:{autoplay:1,controls:1,showinfo:0,modestbranding:1,rel:0,playsinline:1},onStateChange:a=>{a.data===YT.PlayerState.ENDED&&setTimeout(()=>{this._cleanupCardPlayer(t)},1e3)}})}catch(a){console.error("Failed to create in-card player:",a),this._cleanupCardPlayer(t)}}_cleanupCardPlayer(e){if(!e)return;let t=e.querySelector(".player-container"),i=e.querySelector(".video-thumbnail"),s=e.dataset.videoId;s&&this.youtubePlayer&&this.youtubePlayer.stop(s),t&&(t.classList.remove("active"),t.innerHTML=""),i&&i.classList.remove("has-player"),e.classList.remove("playing"),console.log("Cleaned up card player:",e.dataset.videoId)}_handleOverlayPlayback(e){console.log("Playing video in modal:",e.id),document.querySelectorAll(".video-card.playing").forEach(t=>{this._cleanupCardPlayer(t)}),this.videoPlayer?(this.videoPlayer.clearPlaylist(),this.videoPlayer.play(e)):window.open(e.youtube_url,"_blank")}_handleAddToPlaylist(e){if(console.log("Adding video to playlist:",e.id),!this.playlistManager){console.error("Playlist manager not initialized");return}let t=`https://www.youtube.com/watch?v=${e.id}`,i=this.videoGrid._getThumbnailUrl(e.id,e.thmb);this.playlistManager.addVideo(e,"watch_later",t,i)&&(this._showNotification(`Added "${e.title}" to Watch Later`),this._updatePlaylistButtonState(e.id))}_showNotification(e,t="info",i=3e3){let s=document.getElementById("playlist-notification");s&&s.remove();let o=document.createElement("div");if(o.id="playlist-notification",o.className=`playlist-notification ${t}`,o.innerHTML=`
        <span>${e}</span>
        ${i>0?'<button class="notification-close" aria-label="Close"><i class="fas fa-times"></i></button>':""}
    `,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},10),i>0){let a=setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.remove()},300)},i),n=o.querySelector(".notification-close");n&&n.addEventListener("click",()=>{clearTimeout(a),o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.remove()},300)})}return o}_updatePlaylistButtonState(e){document.querySelectorAll(`.add-to-playlist-button[data-video-id="${e}"]`).forEach(t=>{let i=t.querySelector("i");i&&(i.className="fas fa-check",t.title="Added to Watch Later",setTimeout(()=>{i.className="fas fa-plus",t.title="Add to playlist"},2e3))})}_initPlaylistViewToggle(){if(document.getElementById("playlistToggle"))return;let e=document.createElement("button");e.id="playlistToggle",e.className="header-action-button playlist-toggle",e.innerHTML='<i class="fas fa-list"></i><span class="action-text">Playlists</span>',e.title="View Playlists";let t=document.getElementById("clearFilters");if(t&&t.parentNode)t.parentNode.insertBefore(e,t.nextSibling);else{let i=document.querySelector(".header-actions");i&&i.appendChild(e)}e.addEventListener("click",()=>this._togglePlaylistView()),console.log("\u2705 Playlist toggle button initialized")}_togglePlaylistView(){this.playlistView||(this.playlistView=document.getElementById("playlistView"),this.playlistBackdrop=document.getElementById("playlistBackdrop")),this.playlistView.classList.contains("active")?(this.playlistView.classList.remove("active"),this.playlistBackdrop&&this.playlistBackdrop.classList.remove("active"),document.body.classList.remove("playlist-open"),document.body.style.overflow="",document.documentElement.style.overflow="",console.log("Playlist closed")):(this.playlistView.classList.add("active"),this.playlistBackdrop&&this.playlistBackdrop.classList.add("active"),document.body.classList.add("playlist-open"),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",this._loadPlaylist(this.currentPlaylist),console.log("Playlist opened"))}_loadPlaylist(e){if(!this.playlistManager||!this.playlistView)return;this.currentPlaylist=e,document.querySelectorAll(".playlist-tab").forEach(s=>{s.classList.toggle("active",s.dataset.playlist===e)}),this._updatePlaylistCounts();let t=this.playlistManager.getPlaylistVideos(e),i=document.getElementById("playlistVideos");if(i){if(t.length===0){i.innerHTML=`
            <div class="empty-playlist">
                <i class="fas fa-list"></i>
                <p>No videos in this playlist</p>
            </div>
        `;return}i.innerHTML=t.map(s=>`
        <div class="playlist-video-item" data-video-id="${s.id}">
            <div class="playlist-video-thumb">
                <img src="${s.thumbnail}" alt="${s.title}" loading="lazy">
            </div>
            <div class="playlist-video-info">
                <h4 class="playlist-video-title" title="${s.title}">${s.title}</h4>
                <div class="playlist-video-meta">
                    <span>Added: ${new Date(s.addedAt).toLocaleDateString()}</span>
                </div>
            </div>
            <button class="playlist-video-remove" title="Remove from playlist">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `).join(""),this._setupPlaylistItemEvents()}}_setupPlaylistItemEvents(){let e=document.getElementById("playlistVideos");e&&e.addEventListener("click",t=>{let i=t.target.closest(".playlist-video-item");if(!i)return;if(t.target.closest(".playlist-video-remove")){t.stopPropagation(),this._removeFromPlaylist(i.dataset.videoId);return}let o=i.dataset.videoId,a=this.core.getVideo(o);a&&this._handleOverlayPlayback(a)})}_removeFromPlaylist(e){if(!this.playlistManager)return;if(this.playlistManager.removeVideo(e,this.currentPlaylist)){let i=document.querySelector(`.playlist-video-item[data-video-id="${e}"]`);i&&i.remove(),this._showNotification("Removed from playlist"),this._updatePlaylistCounts(),this.playlistManager.getPlaylistVideos(this.currentPlaylist).length===0&&this._loadPlaylist(this.currentPlaylist)}}_updatePlaylistCounts(){if(!this.playlistManager)return;let e=document.getElementById("watchLaterCount"),t=document.getElementById("favoritesCount");e&&(e.textContent=this.playlistManager.getPlaylistCount("watch_later")),t&&(t.textContent=this.playlistManager.getPlaylistCount("favorites"))}_initPlaylistTabs(){document.querySelectorAll(".playlist-tab").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.playlist;t&&this._loadPlaylist(t)})})}_initPlaylistActions(){let e=document.getElementById("playAllBtn"),t=document.getElementById("clearPlaylistBtn"),i=document.getElementById("playlistClose");e&&e.addEventListener("click",()=>this._playAllFromPlaylist()),t&&t.addEventListener("click",()=>this._clearCurrentPlaylist()),i&&i.addEventListener("click",()=>this._togglePlaylistView()),this._setupPlaylistContextMenu()}_playAllFromPlaylist(){if(!this.playlistManager){this._showNotification("Playlist manager not available");return}let e=this.currentPlaylist,t=this.playlistManager.getPlaylistQueue(e);if(t.length===0){this._showNotification("Playlist is empty");return}if(this.videoPlayer){this.videoPlayer.setPlaylist(e,t);let i=this.core.getVideo(t[0].id);i&&this.videoPlayer.play(i),this._togglePlaylistView(),this._showNotification(`Playing playlist: ${t.length} videos`)}else if(t[0]){let i=this.core.getVideo(t[0].id);i&&this._handleOverlayPlayback(i)}}_playVideoFromPlaylist(e,t){let i=this.core.getVideo(e.id);if(!i){console.error("Video not found:",e.id);return}this.currentPlaylistIndex=t,this.videoPlayer?(this.videoPlayer.play(i),this._updatePlayerPlaylistInfo()):this._handleOverlayPlayback(i)}_showPlaylistInfo(e,t){let i=document.getElementById("playlistInfo");if(i){let s=this.playlistManager.getPlaylistName(e);i.innerHTML=`
            <div class="current-playlist-info">
                <i class="fas fa-list"></i>
                <span>${s} (${this.currentPlaylistIndex+1}/${t})</span>
            </div>
        `,i.style.display="block"}}_updatePlayerPlaylistInfo(){let e=document.querySelector(".prev-btn"),t=document.querySelector(".next-btn"),i=document.getElementById("videoModalTitle");if(!(!e||!t||!i)){if(this.isPlaylistPlaying&&this.currentPlaylistQueue.length>0){let s=this.currentPlaylistQueue[this.currentPlaylistIndex];i&&(i.textContent=`(${this.currentPlaylistIndex+1}/${this.currentPlaylistQueue.length}) ${s.title}`)}if(e){let s=this.currentPlaylistIndex>0;e.disabled=!s,e.style.opacity=s?"1":"0.5",e.style.cursor=s?"pointer":"not-allowed"}if(t){let s=this.currentPlaylistIndex<this.currentPlaylistQueue.length-1;t.disabled=!s,t.style.opacity=s?"1":"0.5",t.style.cursor=s?"pointer":"not-allowed"}}}_playNextInPlaylist(){if(!this.isPlaylistPlaying||!this.currentPlaylistId)return;let e=this.currentPlaylistIndex+1;if(e>=this.currentPlaylistQueue.length){this._showNotification("End of playlist"),this._resetPlaylistPlayback();return}let t=this.currentPlaylistQueue[e];this._playVideoFromPlaylist(t,e)}_playPreviousInPlaylist(){if(!this.isPlaylistPlaying||!this.currentPlaylistId)return;let e=this.currentPlaylistIndex-1;if(e<0)return;let t=this.currentPlaylistQueue[e];this._playVideoFromPlaylist(t,e)}_resetPlaylistPlayback(){this.currentPlaylistId=null,this.currentPlaylistQueue=[],this.currentPlaylistIndex=-1,this.isPlaylistPlaying=!1;let e=document.getElementById("playlistInfo");e&&(e.innerHTML="",e.style.display="none");let t=document.getElementById("videoModalTitle");t&&(t.textContent="Playing Video");let i=document.querySelector(".prev-btn"),s=document.querySelector(".next-btn");i&&(i.disabled=!1,i.style.opacity="1",i.style.cursor="pointer"),s&&(s.disabled=!1,s.style.opacity="1",s.style.cursor="pointer")}_clearCurrentPlaylist(){if(!this.playlistManager)return;let e=this.playlistManager.getPlaylistCount(this.currentPlaylist);e!==0&&confirm(`Clear all ${e} videos from this playlist?`)&&this.playlistManager.clearPlaylist(this.currentPlaylist)&&(this._loadPlaylist(this.currentPlaylist),this._showNotification(`Cleared ${e} videos`),this._updatePlaylistCounts())}_loadFavorites(){if(!this.playlistManager)return;let e=this.playlistManager.getFavorites();this.favorites=new Set(e.map(t=>t.id)),console.log(`Loaded ${e.length} favorites`),this._updateVideoCardsFavorites()}_updateVideoCardsFavorites(){if(!this.videoGrid||!this.videoGrid.container)return;this.videoGrid.container.querySelectorAll(".video-card").forEach(t=>{let i=t.dataset.videoId,s=t.querySelector(".favorite-button");if(s&&i){let o=this.favorites.has(i);s.classList.toggle("favorited",o),s.title=o?"Remove from Favorites":"Add to Favorites";let a=s.querySelector("i");a&&(a.className=o?"fas fa-heart":"far fa-heart")}})}_handleToggleFavorite(e){if(!this.playlistManager){console.error("Playlist manager not available");return}let t=`https://www.youtube.com/watch?v=${e.id}`,i=this.videoGrid._getThumbnailUrl(e.id,e.thmb),s=this.playlistManager.toggleFavorite(e,t,i);if(s.action==="error"){this._showNotification("Error updating favorites","error");return}s.added?this.favorites.add(e.id):this.favorites.delete(e.id),this._updateVideoCardsFavorites(),this._updatePlaylistCounts();let o=s.added?`Added "${e.title}" to Favorites`:`Removed "${e.title}" from Favorites`;this._showNotification(o,s.added?"success":"info"),this.currentPlaylist==="favorites"&&this._loadPlaylist("favorites")}_setupPlaylistContextMenu(){let e=document.getElementById("playlistVideos");e&&e.addEventListener("contextmenu",t=>{let i=t.target.closest(".playlist-video-item");if(!i)return;t.preventDefault();let s=i.dataset.videoId,o=this.core.getVideo(s);o&&this._showPlaylistContextMenu(t.clientX,t.clientY,o)})}_showPlaylistContextMenu(e,t,i){let s=document.getElementById("playlist-context-menu");s&&s.remove();let o=this.favorites.has(i.id),a=`
        <div id="playlist-context-menu" class="playlist-context-menu">
            <button class="context-menu-item play-now" data-action="play">
                <i class="fas fa-play"></i> Play Now
            </button>
            <button class="context-menu-item toggle-favorite" data-action="toggleFavorite">
                <i class="${o?"fas":"far"} fa-heart"></i>
                ${o?"Remove from Favorites":"Add to Favorites"}
            </button>
            <button class="context-menu-item remove-from-playlist" data-action="remove">
                <i class="fas fa-trash"></i> Remove from Playlist
            </button>
            <button class="context-menu-item cancel" data-action="cancel">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    `,n=document.createElement("div");n.innerHTML=a,document.body.appendChild(n.firstElementChild);let l=document.getElementById("playlist-context-menu");l.style.left=`${e}px`,l.style.top=`${t}px`,l.addEventListener("click",d=>{let c=d.target.closest("button");if(!c)return;switch(c.dataset.action){case"play":this._handleOverlayPlayback(i);break;case"toggleFavorite":this._handleToggleFavorite(i);break;case"remove":this._removeFromPlaylist(i.id);break;case"cancel":break}l.remove()}),setTimeout(()=>{let d=c=>{l.contains(c.target)||(l.remove(),document.removeEventListener("click",d))};document.addEventListener("click",d)},10)}_batchAddToFavorites(){if(!this.playlistManager){this._showNotification("Playlist manager not available","error");return}let e;if(this.currentFilters.search?e=this.core.searchVideos(this.currentFilters.search,this.currentFilters.category):this.currentFilters.category?e=this.core.filterByCategory(this.currentFilters.category):e=this.core.getOrderedVideos(),!e||e.length===0){this._showNotification("No videos to add to favorites","info");return}let t=e.filter(y=>this.favorites.has(y.id)),i=e.length-t.length;if(i===0){this._showNotification(`All ${e.length} videos are already in Favorites`,"info");return}let s=t.length>0?`Add ${i} new videos to Favorites? (${t.length} are already in Favorites)`:`Add all ${e.length} filtered videos to Favorites?`;if(!confirm(s))return;let o=0,a=0,n=0,l=this._showNotification(`Adding ${i} videos...`,"info",0),d=50,c=y=>{let g=Math.min(y+d,e.length);for(let h=y;h<g;h++){let p=e[h];if(this.favorites.has(p.id)){a++;continue}let S=`https://www.youtube.com/watch?v=${p.id}`,u=this.videoGrid._getThumbnailUrl(p.id,p.thmb),v=this.playlistManager.toggleFavorite(p,S,u);v.added?(o++,this.favorites.add(p.id)):v.action==="removed"?a++:n++}if(l&&l.querySelector("span")){let h=Math.round(g/e.length*100);l.querySelector("span").textContent=`Adding videos... ${h}% (${o} added)`}if(g<e.length)setTimeout(()=>c(g),0);else{this._updateVideoCardsFavorites(),this._updatePlaylistCounts(),l&&l.parentNode&&l.remove();let h=`Added ${o} videos to Favorites`;a>0&&(h+=` (${a} were already in Favorites)`),n>0&&(h+=`, ${n} failed`),this._showNotification(h,o>0?"success":"info"),this._updateBulkFavoriteButton(e.length,!0)}};c(0)}_addBatchFavoriteButton(){if(document.getElementById("batchFavoriteBtn"))return;let e=document.createElement("button");e.id="batchFavoriteBtn",e.className="header-action-button batch-favorite",e.innerHTML='<i class="fas fa-star"></i><span class="action-text">Add to Favorites</span>',e.title="Add all filtered videos to Favorites",e.style.display="none",e.style.marginLeft="auto",e.style.background="linear-gradient(135deg, #f59e0b, #ef4444)",e.style.color="white",e.style.border="none";let t=document.querySelector(".header-actions"),i=document.getElementById("playlistToggle");t&&(i&&i.parentNode===t?t.insertBefore(e,i):t.appendChild(e)),e.addEventListener("click",s=>{s.stopPropagation(),this._batchAddToFavorites()}),console.log("\u2705 Bulk favorite button added")}_hideBulkFavoriteButton(){let e=document.getElementById("batchFavoriteBtn");e&&(e.style.display="none")}_updateBulkFavoriteButton(e,t){let i=document.getElementById("batchFavoriteBtn");if(!i){t&&e>0&&this._addBatchFavoriteButton();return}if(t&&e>0){i.style.display="flex";let s=i.querySelector(".action-text");s&&(s.textContent=`Add ${e} to Favorites`),i.title=`Add all ${e} filtered videos to Favorites`}else i.style.display="none"}};typeof window<"u"&&(window.MobileVideoApp=x);var L=class{constructor(){this.footer=document.getElementById("modernFooter"),this.sidebar=document.getElementById("sidebar"),this.appContent=document.getElementById("main-content"),this.videoGrid=document.getElementById("videoGrid"),this.categoryList=document.getElementById("categoryList"),this.footerHeight=0,this.headerHeight=0,this.safeAreaBottom=0,this.initialized=!1,this.config={extraPadding:30,minSidebarHeight:300,updateDebounceMs:100,debug:!1},this.init()}init(){if(!this.footer){console.warn("LayoutManager: Footer not found");return}this.calculateDimensions(),this.applyAllFixes(),this.setupEventListeners(),this.setupMutationObservers(),this.initialized=!0,this.config.debug&&(console.log("\u{1F3AF} LayoutManager initialized"),this.logDimensions())}calculateDimensions(){this.footerHeight=this.footer.offsetHeight,this.headerHeight=document.querySelector(".app-header")?.offsetHeight||100,this.safeAreaBottom=this.getSafeAreaInsetBottom(),window.innerWidth<768&&(this.footerHeight+=this.safeAreaBottom),this.updateCSSVariables()}getSafeAreaInsetBottom(){let e=document.documentElement,i=getComputedStyle(e).getPropertyValue("--safe-area-inset-bottom").trim();return i.includes("px")?parseInt(i)||0:"visualViewport"in window&&window.visualViewport&&window.visualViewport.height<window.innerHeight?window.innerHeight-window.visualViewport.height:0}updateCSSVariables(){let e=document.documentElement;e.style.setProperty("--footer-height",`${this.footerHeight}px`),e.style.setProperty("--footer-height-sidebar",`${this.footerHeight+10}px`);let t=this.footerHeight+this.config.extraPadding;e.style.setProperty("--footer-safe-padding",`${t}px`);let i=this.footerHeight+this.config.extraPadding+this.safeAreaBottom;e.style.setProperty("--sidebar-mobile-bottom-padding",`${i}px`)}applyAllFixes(){this.fixMainContentOverlap(),this.fixSidebarOverlap(),this.adjustSidebarHeight()}fixMainContentOverlap(){if(this.appContent){let e=this.footerHeight+this.config.extraPadding;this.appContent.style.scrollPaddingBottom=`${e}px`,(parseInt(getComputedStyle(this.appContent).paddingBottom)||0)<e&&(this.appContent.style.paddingBottom=`${e}px`)}if(this.videoGrid){let e=this.footerHeight+this.config.extraPadding+10;this.videoGrid.style.paddingBottom=`${e}px`}}fixSidebarOverlap(){if(this.categoryList){let i=this.footerHeight+this.config.extraPadding+20;this.categoryList.style.paddingBottom=`${i}px`}let e=document.querySelector(".category-tree");if(e){let i=this.footerHeight+this.config.extraPadding;e.style.paddingBottom=`${i}px`}let t=document.querySelector(".category-item:last-child");t&&(t.style.marginBottom=`${this.config.extraPadding}px`)}adjustSidebarHeight(){if(!this.sidebar)return;let e=window.innerHeight,t=window.innerWidth<768,i=this.sidebar.classList.contains("active"),s=this.sidebar.classList.contains("collapsed"),o;t?o=e-this.footerHeight-this.safeAreaBottom:(o=e-this.headerHeight-this.footerHeight,s&&(o+=40)),o=Math.max(o,this.config.minSidebarHeight),t&&i?(this.sidebar.style.height=`${o}px`,this.sidebar.style.maxHeight=`${o}px`):t||(this.sidebar.style.height=`${o}px`,this.sidebar.style.maxHeight=`${o}px`);let a=this.sidebar.querySelector(".category-tree");if(a){let n=o-50;a.style.maxHeight=`${n}px`,a.style.overflowY="auto"}this.config.debug&&console.log(`\u{1F4CF} Sidebar height: ${o}px (mobile: ${t}, active: ${i})`)}setupEventListeners(){let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>this.handleResize(),this.config.updateDebounceMs)}),window.addEventListener("orientationchange",()=>{setTimeout(()=>this.refresh(),300)}),document.addEventListener("click",s=>{s.target.closest(".chevron-container")&&setTimeout(()=>this.handleCategoryToggle(),150)});let t=document.getElementById("menuToggle"),i=document.getElementById("closeSidebar");t&&t.addEventListener("click",()=>{setTimeout(()=>this.handleSidebarToggle(),300)}),i&&i.addEventListener("click",()=>{setTimeout(()=>this.handleSidebarToggle(),300)})}setupMutationObservers(){this.footer&&new MutationObserver(()=>{setTimeout(()=>this.refresh(),50)}).observe(this.footer,{childList:!0,subtree:!0,characterData:!0}),this.sidebar&&new MutationObserver(t=>{t.forEach(i=>{i.attributeName==="class"&&setTimeout(()=>this.handleSidebarClassChange(),100)})}).observe(this.sidebar,{attributes:!0,attributeFilter:["class"]}),this.videoGrid&&new MutationObserver(()=>{setTimeout(()=>this.fixMainContentOverlap(),100)}).observe(this.videoGrid,{childList:!0,subtree:!1})}handleResize(){let e=this.footerHeight,t=this.headerHeight;this.calculateDimensions(),(Math.abs(e-this.footerHeight)>5||Math.abs(t-this.headerHeight)>5)&&(this.refresh(),this.config.debug&&(console.log("\u{1F504} Resize detected, refreshing layout"),this.logDimensions()))}handleCategoryToggle(){setTimeout(()=>{this.checkSidebarOverlap(),this.adjustSidebarHeight()},200)}handleSidebarToggle(){setTimeout(()=>{this.adjustSidebarHeight(),this.checkSidebarOverlap()},350)}handleSidebarClassChange(){setTimeout(()=>{this.adjustSidebarHeight()},100)}checkSidebarOverlap(){if(!this.sidebar||!this.footer||!this.categoryList)return;let e=this.footer.getBoundingClientRect(),t=this.sidebar.querySelectorAll(".category-item"),i=0;if(t.forEach((s,o)=>{let a=s.getBoundingClientRect(),n=e.top-a.bottom;n<5&&(i++,this.config.debug&&console.warn(`\u26A0\uFE0F Category ${o+1} overlapping footer by ${Math.abs(n)}px`))}),i>0){let s=parseInt(this.categoryList.style.paddingBottom)||0,o=i*15,a=s+o;this.categoryList.style.paddingBottom=`${a}px`,this.config.debug&&console.log(`\u2795 Added ${o}px padding for ${i} overlapping categories`)}return i}refresh(){this.initialized&&(this.calculateDimensions(),this.applyAllFixes(),this.config.debug&&(console.log("\u{1F504} LayoutManager refreshed"),this.logDimensions()))}testLayout(){console.log("\u{1F9EA} Running Layout Tests...");let e=this.testContentOverlap(),t=this.testSidebarOverlap();return this.logDimensions(),console.log("\u{1F4CA} Test Results:"),console.log(`  Main Content: ${e?"\u2705 OK":"\u274C Overlap detected"}`),console.log(`  Sidebar: ${t?"\u2705 OK":"\u274C Overlap detected"}`),e&&t}testContentOverlap(){if(!this.appContent||!this.footer)return!0;let e=this.appContent.getBoundingClientRect(),t=this.footer.getBoundingClientRect();return e.bottom<=t.top+10}testSidebarOverlap(){return this.checkSidebarOverlap()===0}logDimensions(){console.log("\u{1F4D0} Current Dimensions:"),console.log(`  Footer: ${this.footerHeight}px`),console.log(`  Header: ${this.headerHeight}px`),console.log(`  Safe Area Bottom: ${this.safeAreaBottom}px`),console.log(`  Viewport: ${window.innerHeight}px x ${window.innerWidth}px`)}destroy(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("orientationchange",this.handleResize),this.config.debug&&console.log("\u{1F5D1}\uFE0F LayoutManager destroyed")}};document.addEventListener("DOMContentLoaded",function(){let r=document.getElementById("disclaimerLink"),e=document.getElementById("disclaimerModal"),t=document.getElementById("modalClose");r&&e&&r.addEventListener("click",function(i){i.preventDefault(),e.style.display="block",document.body.style.overflow="hidden"}),t&&t.addEventListener("click",function(){e.style.display="none",document.body.style.overflow=""}),e&&e.addEventListener("click",function(i){i.target===e&&(e.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",function(i){i.key==="Escape"&&e.style.display==="block"&&(e.style.display="none",document.body.style.overflow="")})});document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){if(window.LayoutManager){if(window.layoutManager=new L,window.app){let r=window.app.init||function(){};window.app.init=function(){r.apply(this,arguments),setTimeout(()=>{window.layoutManager&&window.layoutManager.refresh()},300)}}setTimeout(()=>{window.layoutManager&&window.layoutManager.refresh()},1e3)}},100)});window.addEventListener("load",function(){setTimeout(()=>{window.layoutManager&&window.layoutManager.refresh()},500)})});V();})();
