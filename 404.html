<!DOCTYPE html>
<html>
<head>
    <title>Redirecting to Music Video Library</title>
    <script>
        // Universal Client-Side Router for GitHub Pages
        (function() {
            const path = window.location.pathname;
            console.log('PWA: 404 handler processing path:', path);
            
            // DON'T redirect existing resources, assets, or app files
            const excludedPaths = [
                'wrapper.html',
                '/js/',
                '/css/',
                '/icons/',
                '/resources/',
                '/fonts/',
                '/library/',
                '.css',
                '.js',
                '.png',
                '.jpg',
                '.jpeg',
                '.gif',
                '.svg',
                '.ico',
                '.json',
                '.xml'
            ];
            
            const shouldExclude = excludedPaths.some(excludedPath => 
                path.includes(excludedPath)
            );
            
            if (shouldExclude) {
                console.log('PWA: Skipping redirection for existing resource:', path);
                return; // Let GitHub Pages handle 404 for actual missing files
            }
            
            // Handle clean URLs: /@library
            if (path.startsWith('/@')) {
                const libraryId = path.substring(2);
                console.log('PWA: Routing clean URL to wrapper:', libraryId);
                window.location.href = '/wrapper.html?library=@' + libraryId;
                return;
            }
            
            // Handle library directory paths
            if (path.match(/^\/([A-Z0-9]{6})(\/index\.html)?\/?$/)) {
                const libraryId = path.split('/')[1];
                console.log('PWA: Routing library directory to wrapper:', libraryId);
                window.location.href = '/wrapper.html?library=@' + libraryId;
                return;
            }
            
            // Handle nested library paths  
            if (path.match(/^\/([A-Z0-9]{6})\/([A-Z0-9]{6})(\/index\.html)?\/?$/)) {
                const parts = path.split('/').filter(part => part.length === 6);
                const libraryId = parts[1];
                console.log('PWA: Routing nested library to wrapper:', libraryId);
                window.location.href = '/wrapper.html?library=@' + libraryId;
                return;
            }
            
            // If no patterns match, redirect to main site
            console.log('PWA: Unknown path, redirecting to main site');
            window.location.href = '/';
        })();
    </script>
</head>
<body>
    <p>Redirecting to Music Video Library...</p>
</body>
</html>